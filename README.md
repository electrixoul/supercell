# è¶…ç½‘ç»œ (HyperNetworks) é¡¹ç›®

æœ¬é¡¹ç›®åŸºäºè®ºæ–‡ ["HyperNetworks"](https://arxiv.org/pdf/1609.09106.pdf) (Ha, Dai & Le, 2016)ï¼Œå®ç°äº†é™æ€è¶…ç½‘ç»œå’ŒåŠ¨æ€è¶…ç½‘ç»œï¼ˆHyperLSTMï¼‰æ¨¡å‹ã€‚é™æ€è¶…ç½‘ç»œåº”ç”¨äºMNISTå›¾åƒåˆ†ç±»ä»»åŠ¡ï¼Œè€ŒåŠ¨æ€è¶…ç½‘ç»œï¼ˆHyperLSTMï¼‰åº”ç”¨äºå­—ç¬¦çº§è¯­è¨€å»ºæ¨¡ä»»åŠ¡ã€‚é¡¹ç›®æä¾›äº†PyTorchå’ŒTensorFlowå®ç°ã€‚

## ğŸ“ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [è¶…ç½‘ç»œç†è®º](#è¶…ç½‘ç»œç†è®º)
  - [åŸºæœ¬æ¦‚å¿µ](#åŸºæœ¬æ¦‚å¿µ)
  - [é™æ€è¶…ç½‘ç»œ](#é™æ€è¶…ç½‘ç»œ)
  - [åŠ¨æ€è¶…ç½‘ç»œ](#åŠ¨æ€è¶…ç½‘ç»œ)
- [å®ç°ä¸€ï¼šé™æ€è¶…ç½‘ç»œç”¨äºå›¾åƒåˆ†ç±»](#å®ç°ä¸€é™æ€è¶…ç½‘ç»œç”¨äºå›¾åƒåˆ†ç±»)
  - [é™æ€è¶…ç½‘ç»œå®ç°ç»†èŠ‚](#é™æ€è¶…ç½‘ç»œå®ç°ç»†èŠ‚)
  - [å‚æ•°æ¯”è¾ƒ](#å‚æ•°æ¯”è¾ƒ)
  - [å®éªŒç»“æœ](#é™æ€è¶…ç½‘ç»œå®éªŒç»“æœ)
- [å®ç°äºŒï¼šHyperLSTMç”¨äºåºåˆ—å»ºæ¨¡](#å®ç°äºŒhyperlstmç”¨äºåºåˆ—å»ºæ¨¡)
  - [HyperLSTMæ¶æ„](#hyperlstmæ¶æ„)
  - [HyperLSTMå®ç°ç»†èŠ‚](#hyperlstmå®ç°ç»†èŠ‚)
  - [å®éªŒç»“æœ](#hyperlstmå®éªŒç»“æœ)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
  - [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
  - [è¿è¡Œé™æ€è¶…ç½‘ç»œ](#è¿è¡Œé™æ€è¶…ç½‘ç»œ)
  - [è¿è¡ŒHyperLSTM](#è¿è¡Œhyperlstm)
- [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)
- [è®¸å¯è¯](#è®¸å¯è¯)

## é¡¹ç›®æ¦‚è¿°

è¶…ç½‘ç»œæ˜¯ä¸€ç§å…ƒå­¦ä¹ æ¶æ„ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯"ä½¿ç”¨ä¸€ä¸ªç½‘ç»œç”Ÿæˆå¦ä¸€ä¸ªç½‘ç»œçš„æƒé‡"ã€‚åœ¨ä¼ ç»Ÿç¥ç»ç½‘ç»œä¸­ï¼Œæƒé‡æ˜¯é€šè¿‡åå‘ä¼ æ’­ç›´æ¥å­¦ä¹ çš„å‚æ•°ï¼›è€Œåœ¨è¶…ç½‘ç»œä¸­ï¼Œæƒé‡æ˜¯ç”±å¦ä¸€ä¸ªç½‘ç»œï¼ˆç§°ä¸ºè¶…ç½‘ç»œï¼‰åŠ¨æ€ç”Ÿæˆçš„ã€‚

æœ¬é¡¹ç›®å®ç°äº†è®ºæ–‡ä¸­çš„ä¸¤ç§è¶…ç½‘ç»œå˜ä½“ï¼š

1. **é™æ€è¶…ç½‘ç»œ**ï¼šç”ŸæˆCNNçš„å·ç§¯å±‚æƒé‡ï¼Œåº”ç”¨äºMNISTå›¾åƒåˆ†ç±»ä»»åŠ¡
2. **åŠ¨æ€è¶…ç½‘ç»œï¼ˆHyperLSTMï¼‰**ï¼šä½¿ç”¨è¾…åŠ©LSTMåŠ¨æ€ç”Ÿæˆä¸»LSTMæƒé‡ï¼Œåº”ç”¨äºå­—ç¬¦çº§è¯­è¨€å»ºæ¨¡ä»»åŠ¡

è¿™ä¸¤ç§å®ç°å±•ç¤ºäº†è¶…ç½‘ç»œåœ¨ä¸åŒä»»åŠ¡ç±»å‹ä¸Šçš„åº”ç”¨å’Œä¼˜åŠ¿ã€‚

## è¶…ç½‘ç»œç†è®º

### åŸºæœ¬æ¦‚å¿µ

åœ¨è®ºæ–‡ä¸­ï¼Œè¶…ç½‘ç»œè¢«å®šä¹‰ä¸ºä¸€ä¸ªç”Ÿæˆå¦ä¸€ä¸ªç½‘ç»œæƒé‡çš„ç½‘ç»œã€‚å¦‚æœæˆ‘ä»¬å°†ä¸»ç½‘ç»œè¡¨ç¤ºä¸ºå‡½æ•° f(x; Î¸)ï¼Œå…¶ä¸­Î¸æ˜¯æƒé‡å‚æ•°ï¼Œé‚£ä¹ˆè¶…ç½‘ç»œå¯ä»¥è¡¨ç¤ºä¸º g(z; Ï†)ï¼Œå…¶ä¸­:

- f æ˜¯ä¸»ç½‘ç»œï¼ˆè¢«ç”Ÿæˆçš„ç½‘ç»œï¼‰
- g æ˜¯è¶…ç½‘ç»œï¼ˆç”Ÿæˆæƒé‡çš„ç½‘ç»œï¼‰
- x æ˜¯ä¸»ç½‘ç»œçš„è¾“å…¥
- z æ˜¯è¶…ç½‘ç»œçš„è¾“å…¥
- Î¸ = g(z; Ï†) æ˜¯ç”±è¶…ç½‘ç»œç”Ÿæˆçš„ä¸»ç½‘ç»œæƒé‡
- Ï† æ˜¯è¶…ç½‘ç»œè‡ªå·±çš„æƒé‡å‚æ•°

è¿™ç§æ–¹æ³•å…è®¸é€šè¿‡ä¸€ä¸ªå°å‹ç½‘ç»œé—´æ¥å‚æ•°åŒ–ä¸€ä¸ªå¯èƒ½æ›´å¤§çš„ç½‘ç»œï¼Œä»è€Œæä¾›æ›´ç´§å‡‘çš„æ¨¡å‹è¡¨ç¤ºå’Œæ›´çµæ´»çš„æƒé‡ç”Ÿæˆæœºåˆ¶ã€‚

### é™æ€è¶…ç½‘ç»œ

é™æ€è¶…ç½‘ç»œæ˜¯è¶…ç½‘ç»œçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå…¶ä¸­è¾“å…¥ z æ˜¯å¯å­¦ä¹ çš„å‚æ•°è€Œéå¤–éƒ¨è¾“å…¥ã€‚é™æ€è¶…ç½‘ç»œçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

1. åˆå§‹åŒ–ä¸€ä¸ªæ½œåœ¨å‘é‡ zï¼ˆä½ç»´ï¼‰
2. z é€šè¿‡è¶…ç½‘ç»œ g è½¬æ¢ä¸ºæƒé‡å‚æ•° Î¸
3. ä¸»ç½‘ç»œ f ä½¿ç”¨ç”Ÿæˆçš„æƒé‡ Î¸ è¿›è¡Œæ­£å¸¸çš„å‰å‘ä¼ æ’­
4. åœ¨åå‘ä¼ æ’­ä¸­ï¼Œæ¢¯åº¦æµç»ä¸»ç½‘ç»œåˆ°è¶…ç½‘ç»œï¼ŒåŒæ—¶æ›´æ–° zã€è¶…ç½‘ç»œå‚æ•° Ï† å’Œä¸»ç½‘ç»œä¸­çš„å…¶ä»–å‚æ•°

![é™æ€è¶…ç½‘ç»œæ¶æ„](assets/static_hyper_network.svg)

### åŠ¨æ€è¶…ç½‘ç»œ

åŠ¨æ€è¶…ç½‘ç»œå°†è¾“å…¥ z è§†ä¸ºå¤–éƒ¨è¾“å…¥ï¼ˆå¦‚å½“å‰ç½‘ç»œçŠ¶æ€æˆ–è¾“å…¥ç‰¹å¾çš„å‡½æ•°ï¼‰ï¼Œè¿™ä½¿å¾—ç½‘ç»œèƒ½å¤Ÿä¸ºæ¯ä¸ªè¾“å…¥åŠ¨æ€ç”Ÿæˆä¸åŒçš„æƒé‡ã€‚è¿™åœ¨å¤„ç†åºåˆ—æ•°æ®ç­‰ä»»åŠ¡ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æ¨¡å‹æ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€è°ƒæ•´å…¶å‚æ•°ã€‚

åŠ¨æ€è¶…ç½‘ç»œçš„ä¸€ä¸ªé‡è¦å®ç°æ˜¯HyperLSTMï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªå°å‹LSTMï¼ˆç§°ä¸ºhyper-LSTMï¼‰ç”Ÿæˆä¸»LSTMçš„æƒé‡ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€è°ƒæ•´å¤„ç†ç­–ç•¥çš„ä»»åŠ¡ï¼Œå¦‚å¤æ‚çš„æ–‡æœ¬å»ºæ¨¡ã€‚

## å®ç°ä¸€ï¼šé™æ€è¶…ç½‘ç»œç”¨äºå›¾åƒåˆ†ç±»

### é™æ€è¶…ç½‘ç»œå®ç°ç»†èŠ‚

åœ¨PyTorchå®ç°ä¸­ï¼Œé™æ€è¶…ç½‘ç»œæ¨¡å‹å®šä¹‰åœ¨`HyperCNN`ç±»ä¸­ã€‚å…¶æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š

#### 1. æ½œåœ¨å‘é‡ z (z_signal)

```python
# è®ºæ–‡3.1èŠ‚æåˆ°ï¼Œé™æ€è¶…ç½‘ç»œçš„è¾“å…¥æ˜¯ä¸€ä¸ªå›ºå®šçš„æ½œåœ¨å‘é‡z
self.z_signal = nn.Parameter(torch.randn(1, z_dim) * 0.01)
```

è¿™æ˜¯è¶…ç½‘ç»œçš„è¾“å…¥ï¼Œæ˜¯ä¸€ä¸ªå¯å­¦ä¹ çš„å‚æ•°ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šéšç€æ¢¯åº¦æ›´æ–°ã€‚z_dimæ§åˆ¶äº†è¶…ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ï¼Œåœ¨æœ¬å®ç°ä¸­é»˜è®¤è®¾ä¸º4ã€‚

#### 2. è¶…ç½‘ç»œå±‚

```python
# ç¬¬ä¸€å±‚å˜æ¢ - z â†’ ä¸­é—´è¡¨ç¤º
self.w2 = nn.Parameter(torch.randn(z_dim, in_size * z_dim) * 0.01)
self.b2 = nn.Parameter(torch.zeros(in_size * z_dim))

# ç¬¬äºŒå±‚å˜æ¢ - ä¸­é—´è¡¨ç¤º â†’ æœ€ç»ˆæƒé‡
self.w1 = nn.Parameter(torch.randn(z_dim, out_size * f_size * f_size) * 0.01)
self.b1 = nn.Parameter(torch.zeros(out_size * f_size * f_size))
```

è¶…ç½‘ç»œç”±ä¸¤å±‚çº¿æ€§å˜æ¢ç»„æˆï¼Œå°†ä½ç»´æ½œåœ¨å‘é‡ z æ˜ å°„åˆ°é«˜ç»´æƒé‡ç©ºé—´ã€‚

#### 3. æƒé‡ç”Ÿæˆå‡½æ•°

```python
def generate_conv2_weights(self):
    """ä½¿ç”¨è¶…ç½‘ç»œç”Ÿæˆç¬¬äºŒä¸ªå·ç§¯å±‚çš„æƒé‡"""
    # æ­¥éª¤1: z_signalé€šè¿‡ç¬¬ä¸€å±‚å˜æ¢
    h_in = torch.matmul(self.z_signal, self.w2) + self.b2
    h_in = h_in.reshape(self.in_size, self.z_dim)
    
    # æ­¥éª¤2: ä¸­é—´è¡¨ç¤ºé€šè¿‡ç¬¬äºŒå±‚å˜æ¢
    h_final = torch.matmul(h_in, self.w1) + self.b1
    
    # æ­¥éª¤3: é‡å¡‘ä¸ºå·ç§¯æ ¸æ ¼å¼
    kernel = h_final.reshape(self.out_size, self.in_size, self.f_size, self.f_size)
    return kernel
```

è¿™ä¸ªå‡½æ•°å®ç°äº†è¶…ç½‘ç»œç”Ÿæˆä¸»ç½‘ç»œæƒé‡çš„æ ¸å¿ƒé€»è¾‘ï¼šä»æ½œåœ¨å‘é‡ z å¼€å§‹ï¼Œç»è¿‡ä¸¤æ¬¡çº¿æ€§å˜æ¢ï¼Œæœ€ç»ˆç”Ÿæˆå·ç§¯æƒé‡çŸ©é˜µã€‚

### å‚æ•°æ¯”è¾ƒ

è®ºæ–‡ç¬¬4.2èŠ‚è®¨è®ºäº†è¶…ç½‘ç»œå¦‚ä½•å‡å°‘å‚æ•°æ•°é‡ã€‚ä»¥æˆ‘ä»¬çš„å®ç°ä¸ºä¾‹ï¼Œæ ‡å‡†CNNå’Œè¶…ç½‘ç»œCNNçš„å‚æ•°æ•°é‡å¦‚ä¸‹ï¼š

**æ ‡å‡†CNNå‚æ•°**:
- ç¬¬äºŒä¸ªå·ç§¯å±‚ï¼š7Ã—7Ã—16Ã—16 = 12,544ä¸ªå‚æ•°

**è¶…ç½‘ç»œå‚æ•°**:
- æ½œåœ¨å‘é‡ zï¼š4ä¸ªå‚æ•°
- ç¬¬ä¸€å±‚å˜æ¢ï¼š4Ã—(16Ã—4) + 16Ã—4 = 320ä¸ªå‚æ•°
- ç¬¬äºŒå±‚å˜æ¢ï¼š4Ã—(16Ã—7Ã—7) + 16Ã—7Ã—7 = 3,200ä¸ªå‚æ•°
- æ€»è®¡ï¼š3,524ä¸ªå‚æ•°

è™½ç„¶åœ¨è¿™ä¸ªç®€å•ç¤ºä¾‹ä¸­ï¼Œè¶…ç½‘ç»œçš„å‚æ•°å‡å°‘ä¸æ˜¯å¾ˆæ˜¾è‘—ï¼Œä½†åœ¨æ›´å¤§çš„æ¨¡å‹ä¸­ï¼Œå‚æ•°å‡å°‘å¯èƒ½ä¼šæ›´åŠ æ˜æ˜¾ã€‚

### é™æ€è¶…ç½‘ç»œå®éªŒç»“æœ

åœ¨MNISTæ•°æ®é›†ä¸Šï¼Œæ ‡å‡†CNNå’Œè¶…ç½‘ç»œCNNéƒ½èƒ½è¾¾åˆ°ç±»ä¼¼çš„åˆ†ç±»æ€§èƒ½ã€‚æˆ‘ä»¬çš„å®éªŒè¡¨æ˜ï¼š

1. æ ‡å‡†CNNåœ¨è®­ç»ƒæ—©æœŸé€šå¸¸æ”¶æ•›æ›´å¿«
2. è¶…ç½‘ç»œCNNæœ€ç»ˆå¯ä»¥è¾¾åˆ°ä¸æ ‡å‡†CNNç›¸å½“çš„æµ‹è¯•ç²¾åº¦
3. è¶…ç½‘ç»œCNNåœ¨å‚æ•°æ•°é‡ä¸Šæœ‰ä¸€å®šä¼˜åŠ¿

é€šè¿‡å¯è§†åŒ–ç”Ÿæˆçš„å·ç§¯æ»¤æ³¢å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ï¼š

1. æ ‡å‡†CNNå­¦ä¹ çš„æ»¤æ³¢å™¨é€šå¸¸æ›´åŠ åˆ†æ•£å’Œå¤šæ ·åŒ–
2. è¶…ç½‘ç»œç”Ÿæˆçš„æ»¤æ³¢å™¨å±•ç°å‡ºæ›´å¤šçš„ç»“æ„å’Œè§„å¾‹æ€§
3. è¿™ç§å·®å¼‚ä½“ç°äº†è¶…ç½‘ç»œé€šè¿‡æ½œåœ¨ç©ºé—´çš„ä½ç»´è¡¨ç¤ºæ–½åŠ çš„éšå¼æ­£åˆ™åŒ–

## å®ç°äºŒï¼šHyperLSTMç”¨äºåºåˆ—å»ºæ¨¡

### HyperLSTMæ¶æ„

HyperLSTM æ˜¯è¶…ç½‘ç»œçš„ä¸€ç§åŠ¨æ€å®ç°ï¼Œå…¶ä¸­æƒé‡ç”±ä¸€ä¸ªè¾…åŠ©ç½‘ç»œæ ¹æ®å½“å‰è¾“å…¥å’ŒçŠ¶æ€åŠ¨æ€ç”Ÿæˆã€‚HyperLSTM çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

1. **åŠ¨æ€æƒé‡ç”Ÿæˆ**ï¼šä½¿ç”¨ä¸€ä¸ªå°å‹ LSTMï¼ˆç§°ä¸º hyper-LSTMï¼‰æ ¹æ®å½“å‰çš„è¾“å…¥å’ŒçŠ¶æ€åŠ¨æ€ç”Ÿæˆä¸» LSTM çš„æƒé‡ã€‚

2. **æƒé‡è°ƒåˆ¶ç­–ç•¥**ï¼šåŸè®ºæ–‡ä¸­æå‡ºäº†ä¸¤ç§æƒé‡ç”Ÿæˆç­–ç•¥ï¼š
   - **æƒé‡ç¼©æ”¾**ï¼ˆWeight Scalingï¼‰ï¼šä¿ç•™åŸå§‹æƒé‡ï¼Œä½†é€šè¿‡ç”Ÿæˆçš„å› å­è¿›è¡Œç¼©æ”¾è°ƒåˆ¶
   - **å…¨æƒé‡ç”Ÿæˆ**ï¼ˆFull Weight Generationï¼‰ï¼šç›´æ¥ç”Ÿæˆæ›¿æ¢åŸå§‹æƒé‡çš„æ–°æƒé‡

3. **æƒé‡åˆ†è§£**ï¼ˆWeight Factorizationï¼‰ï¼šä¸ºäº†å‡å°‘å‚æ•°æ•°é‡å’Œè®¡ç®—é‡ï¼Œè¶…ç½‘ç»œé€šè¿‡ä¸€ä¸ªä¸¤çº§æ˜ å°„ç³»ç»Ÿç”Ÿæˆæƒé‡ï¼šé¦–å…ˆå°†è¾“å…¥æ˜ å°„åˆ°ä½ç»´åµŒå…¥ç©ºé—´ï¼Œç„¶åä»åµŒå…¥ç©ºé—´æ˜ å°„åˆ°ç›®æ ‡æƒé‡ç©ºé—´ã€‚

HyperLSTMçš„åŸºæœ¬ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HyperLSTM Cell                         â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚            â”‚                                                â”‚
â”‚  â”‚ Input (x)  â”‚                                                â”‚
â”‚  â”‚            â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚        â”‚                                                       â”‚
â”‚        â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            â”‚        â”‚            â”‚        â”‚            â”‚    â”‚
â”‚  â”‚ Hyper-LSTM â”œâ”€â”€â”€â”€â”€â”€â”€â–ºâ”‚HyperLinear â”œâ”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Main LSTM  â”‚    â”‚
â”‚  â”‚            â”‚        â”‚            â”‚        â”‚            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                    â”‚           â”‚
â”‚                                                    â–¼           â”‚
â”‚                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                             â”‚            â”‚     â”‚
â”‚                                             â”‚  Output    â”‚     â”‚
â”‚                                             â”‚            â”‚     â”‚
â”‚                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HyperLSTMå®ç°ç»†èŠ‚

æˆ‘ä»¬çš„HyperLSTMå®ç°åŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

#### 1. HyperLSTMCell

HyperLSTMå•å…ƒæ˜¯æ•´ä¸ªæ¨¡å‹çš„æ ¸å¿ƒï¼Œå®ƒåŒ…å«ä¸»LSTMå’Œè¾…åŠ©çš„hyper-LSTMã€‚å®ƒçš„å·¥ä½œæµç¨‹æ˜¯ï¼š

1. è¾…åŠ©LSTMï¼ˆhyper-LSTMï¼‰æ¥æ”¶è¾“å…¥å’Œä¸Šä¸€æ—¶åˆ»ä¸»LSTMçš„éšè—çŠ¶æ€
2. è¾…åŠ©LSTMç”ŸæˆåŠ¨æ€å‚æ•°
3. è¿™äº›åŠ¨æ€å‚æ•°é€šè¿‡HyperLinearæ¨¡å—è°ƒåˆ¶ä¸»LSTMçš„æƒé‡
4. è°ƒåˆ¶åçš„ä¸»LSTMå¤„ç†å½“å‰è¾“å…¥å¹¶ç”Ÿæˆè¾“å‡º

#### 2. HyperLinearæ¨¡å—

HyperLinearæ¨¡å—å®ç°äº†æƒé‡åˆ†è§£çš„ä¸¤çº§æ˜ å°„ç³»ç»Ÿï¼š

```python
class HyperLinear(nn.Module):
    """
    Hypernetwork for dynamic weight generation
    """
    def __init__(self, input_size, embedding_size, output_size, use_bias=True):
        super(HyperLinear, self).__init__()
        
        # ç¬¬ä¸€çº§æ˜ å°„ï¼šz -> embeddingï¼ˆå°†hyper LSTMçš„è¾“å‡ºæ˜ å°„åˆ°ä½ç»´åµŒå…¥ç©ºé—´ï¼‰
        self.z_linear = SuperLinear(input_size, embedding_size, 
                                    init_w="gaussian", weight_start=0.01,
                                    use_bias=True, bias_start=1.0)
        
        # ç¬¬äºŒçº§æ˜ å°„ï¼šembedding -> output weightsï¼ˆä»åµŒå…¥ç©ºé—´ç”Ÿæˆç›®æ ‡æƒé‡ï¼‰
        self.weight_linear = SuperLinear(embedding_size, output_size, 
                                        init_w="constant", weight_start=0.1/embedding_size,
                                        use_bias=False)
```

#### 3. å¢å¼ºæŠ€æœ¯

ä¸ºäº†æé«˜æ¨¡å‹æ€§èƒ½ï¼Œæˆ‘ä»¬å®ç°äº†å‡ ç§å¢å¼ºæŠ€æœ¯ï¼š

- **å±‚å½’ä¸€åŒ–**ï¼ˆLayer Normalizationï¼‰ï¼šç¨³å®šè®­ç»ƒè¿‡ç¨‹ï¼Œå‡å°‘å†…éƒ¨åå˜é‡åç§»
- **æ­£äº¤åˆå§‹åŒ–**ï¼ˆOrthogonal Initializationï¼‰ï¼šæ”¹å–„æ¢¯åº¦æµ
- **å¾ªç¯ Dropout**ï¼ˆRecurrent Dropoutï¼‰ï¼šå¢å¼ºæ­£åˆ™åŒ–ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ

### HyperLSTMå®éªŒç»“æœ

åœ¨å­—ç¬¦çº§è¯­è¨€å»ºæ¨¡ä»»åŠ¡ä¸Šï¼ŒHyperLSTMç›¸æ¯”æ ‡å‡†LSTMè¡¨ç°å‡ºæ˜æ˜¾çš„ä¼˜åŠ¿ï¼š

1. **é•¿æœŸä¾èµ–å¤„ç†**ï¼šé€šè¿‡åŠ¨æ€è°ƒæ•´æƒé‡ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°ä¿æŒå’Œåˆ©ç”¨é•¿åºåˆ—ä¸­çš„è¿œè·ç¦»ä¿¡æ¯
2. **ä¸Šä¸‹æ–‡æ•æ„Ÿæ€§**ï¼šå¯¹è¾“å…¥åºåˆ—çš„å˜åŒ–æ›´æ•æ„Ÿï¼Œèƒ½å¤Ÿè‡ªé€‚åº”è°ƒæ•´å¤„ç†ç­–ç•¥
3. **æ³›åŒ–èƒ½åŠ›**ï¼šåœ¨æœ‰é™è®­ç»ƒæ•°æ®ä¸Šè¡¨ç°å‡ºæ›´å¥½çš„æ³›åŒ–èƒ½åŠ›
4. **è¡¨ç°åŠ›**ï¼šå°½ç®¡å‚æ•°æ€»é‡å¯èƒ½ç›¸ä¼¼ï¼Œä½†åŠ¨æ€æƒé‡ç”Ÿæˆæœºåˆ¶å¤§å¤§å¢å¼ºäº†æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›

## ä½¿ç”¨æŒ‡å—

### ç¯å¢ƒé…ç½®

æœ¬é¡¹ç›®éœ€è¦ä»¥ä¸‹ç¯å¢ƒï¼š

```bash
conda create -n sae python=3.8
conda activate sae

# åŸºæœ¬ä¾èµ–
pip install torch torchvision matplotlib numpy

# å¯¹äºTensorFlowç‰ˆæœ¬
pip install tensorflow==2.8.0 keras
```

### è¿è¡Œé™æ€è¶…ç½‘ç»œ

**PyTorchç‰ˆæœ¬**:

```bash
python mnist_hypernetwork_pytorch.py
```

**TensorFlowç‰ˆæœ¬**:

```bash
python mnist_hypernetwork_simplified.py
```

è¿™äº›è„šæœ¬ä¼šè®­ç»ƒæ ‡å‡†CNNå’Œè¶…ç½‘ç»œCNNï¼Œå¹¶ç”Ÿæˆæƒé‡å¯è§†åŒ–ç»“æœã€‚

### è¿è¡ŒHyperLSTM

**è®­ç»ƒæ¨¡å‹**:

```bash
python hyperlstm_train.py --mode train \
    --data_path data/your_data.txt \
    --epochs 20 \
    --seq_length 100 \
    --batch_size 32 \
    --hidden_size 512 \
    --hyper_num_units 128 \
    --hyper_embedding_size 16 \
    --use_layer_norm
```

**ç”Ÿæˆæ–‡æœ¬**:

```bash
python hyperlstm_train.py --mode generate \
    --data_path data/your_data.txt \
    --prime_text "The" \
    --gen_length 1000 \
    --temperature 0.8 \
    --load_model models/hyperlstm_best.pt
```

**è¯„ä¼°æ¨¡å‹**:

```bash
python hyperlstm_train.py --mode eval \
    --data_path data/your_data.txt \
    --load_model models/hyperlstm_best.pt
```

#### HyperLSTMå‚æ•°è¯´æ˜

##### æ•°æ®å‚æ•°
- `--data_path`: è®­ç»ƒæ•°æ®æ–‡ä»¶è·¯å¾„
- `--seq_length`: è®­ç»ƒåºåˆ—é•¿åº¦
- `--batch_size`: æ‰¹é‡å¤§å°
- `--val_split`: éªŒè¯é›†æ¯”ä¾‹

##### æ¨¡å‹å‚æ•°
- `--embedding_size`: å­—ç¬¦åµŒå…¥å¤§å°
- `--hidden_size`: ä¸» LSTM çš„éšè—å±‚å¤§å°
- `--num_layers`: LSTM å±‚æ•°
- `--dropout`: å±‚é—´ Dropout æ¦‚ç‡
- `--hyper_num_units`: HyperLSTM è¾…åŠ©ç½‘ç»œä¸­çš„å•å…ƒæ•°é‡
- `--hyper_embedding_size`: è¶…ç½‘ç»œåµŒå…¥ç©ºé—´çš„å¤§å°
- `--use_layer_norm`: å¯ç”¨å±‚å½’ä¸€åŒ–
- `--use_recurrent_dropout`: å¯ç”¨å¾ªç¯ Dropout
- `--dropout_keep_prob`: å¾ªç¯ Dropout çš„ä¿ç•™æ¦‚ç‡

##### è®­ç»ƒå‚æ•°
- `--epochs`: è®­ç»ƒè½®æ•°
- `--lr`: åˆå§‹å­¦ä¹ ç‡
- `--lr_decay`: å­¦ä¹ ç‡è¡°å‡å› å­
- `--patience`: å­¦ä¹ ç‡è°ƒåº¦çš„è€å¿ƒå€¼
- `--clip`: æ¢¯åº¦è£å‰ªå€¼

##### ç”Ÿæˆå‚æ•°
- `--temperature`: ç”Ÿæˆæ–‡æœ¬æ—¶çš„æ¸©åº¦å‚æ•°ï¼ˆæ§åˆ¶éšæœºæ€§ï¼Œè¶Šé«˜è¶Šéšæœºï¼‰
- `--gen_length`: ç”Ÿæˆæ–‡æœ¬çš„é•¿åº¦
- `--prime_text`: ç”¨äºå¯åŠ¨ç”Ÿæˆçš„ç§å­æ–‡æœ¬

## å‚è€ƒèµ„æ–™

1. [HyperNetworksè®ºæ–‡](https://arxiv.org/pdf/1609.09106.pdf) - David Ha, Andrew Dai, Quoc V. Le (2016)
2. [åŸå§‹TensorFlowå®ç°](https://github.com/hardmaru/supercell/blob/master/supercell.py) - David Ha

## è®¸å¯è¯

MIT

---

*æ³¨ï¼šæ­¤é¡¹ç›®ä¸ºå­¦æœ¯ç ”ç©¶å’Œæ•™è‚²ç›®çš„è€Œåˆ›å»ºã€‚*
